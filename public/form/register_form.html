<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Đăng ký Overlay</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f6f6;
    }

    .form-label {
      font-weight: 600;
    }

    .modal-content {
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    }

    .nav-tabs .nav-link.active {
      font-weight: bold;
      color: #dc3545;
      border: none;
      border-bottom: 2px solid #dc3545;
    }

    .btn-close {
      background-color: transparent;
      border: none;
    }
  </style>
  <link rel="stylesheet" href="/src/css/style.css" />
  <link rel="stylesheet" href="/src/css/service.css" />
  <script src="/src/js/layout.js" defer></script>
  <script src="/src/js/packages.js" defer></script>
</head>

<body>
  <div id="header"></div>
  <div class="tab-content">
    <div class="tab-pane fade show active" id="mobile">
      <form>
        <!-- Hàng 1: Tên đăng nhập + Mật khẩu + Xác nhận mật khẩu -->
        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">Tên đăng nhập*</label>
            <input type="text" name="username" class="form-control" placeholder="Tên đăng nhập" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Mật khẩu*</label>
            <input type="password" class="form-control" placeholder="Mật khẩu" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Xác nhận mật khẩu*</label>
            <input type="password" class="form-control" placeholder="Xác nhận mật khẩu" required>
          </div>
        </div>

        <!-- Hàng 2: Họ và Tên -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Họ*</label>
            <input type="text" name="firstName" class="form-control" placeholder="Họ" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Tên*</label>
            <input type="text" name="lastName" class="form-control" placeholder="Tên" required>
          </div>
        </div>

        <!-- Hàng 3: Ngày sinh + Giới tính + Số điện thoại -->
        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">Ngày sinh*</label>
            <input type="date" name="birthday" class="form-control" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Giới tính*</label>
            <select class="form-select" required>
              <option value="">Chọn giới tính</option>
              <option value="Nam">Nam</option>
              <option value="Nữ">Nữ</option>
            </select>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Số điện thoại*</label>
            <input type="tel" name="phone" class="form-control" placeholder="Số điện thoại" required>
          </div>
        </div>

        <!-- Hàng 4: Email + Địa chỉ -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Email*</label>
            <input type="email" name="egmail" class="form-control" placeholder="Email" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Địa chỉ </label>
            <input type="text" class="form-control" placeholder="VD: 123 Đường A, TP. HCM" list="city-list" required>
            <datalist id="city-list">
              <option value="Hà Nội">
              <option value="TP. Hồ Chí Minh">
              <option value="Đà Nẵng">
              <option value="Cần Thơ">
              <option value="Hải Phòng">
            </datalist>
          </div>
        </div>

        <!-- Điều khoản và nút đăng ký -->
        <div class="form-check mt-2 mb-3">
          <input class="form-check-input" type="checkbox" required>
          <label class="form-check-label small">
            Tôi đồng ý với
            <a href="#" class="text-danger">Điều khoản sử dụng</a> và
            <a href="#" class="text-danger">Chính sách bảo mật</a>
          </label>
        </div>

        <div class="d-grid">
          <button type="submit" class="btn btn-danger">Đăng ký tài khoản</button>
        </div>

        <div class="text-center mt-3">
          <small>Đã có tài khoản? <a href="#" class="text-danger">Đăng nhập ngay</a></small>
        </div>
      </form>
    </div>
  </div>


  <!-- Script đóng modal -->
  <script>
    function closeRegisterModal() {
      window.location.href = "/"; // hoặc đổi thành URL bạn muốn
    }

  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <div id="footer"></div>

  <script src="/src/js/login_popup.js" defer></script>
  <script src="/src/js/login.js" defer></script>

</body>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector("#mobile form");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Lấy dữ liệu từ form theo thứ tự phần tử bạn đã dán
      const username = form.querySelector('input[placeholder="Tên đăng nhập"]').value.trim();
      const password = form.querySelector('input[placeholder="Mật khẩu"]').value;
      const confirmPassword = form.querySelector('input[placeholder="Xác nhận mật khẩu"]').value;

      const firstName = form.querySelector('input[placeholder="Họ"]').value.trim();
      const lastName = form.querySelector('input[placeholder="Tên"]').value.trim();
      const birthDate = form.querySelector('input[type="date"]').value;
      const genderText = form.querySelector('select').value;
      const phone = form.querySelector('input[placeholder="Số điện thoại"]').value.trim();
      const email = form.querySelector('input[placeholder="Email"]').value.trim();
      const address = form.querySelector('input[list="city-list"]').value.trim();

      // Kiểm tra mật khẩu khớp
      if (password !== confirmPassword) {
        alert("⚠️ Mật khẩu không khớp!");
        return;
      }
      // ✅ Kiểm tra số điện thoại: phải là chuỗi số, 10 chữ số
      if (!/^\d{10}$/.test(phone)) {
        alert("⚠️ Số điện thoại phải có đúng 10 chữ số!");
        return;
      }

      // ✅ Kiểm tra đủ 18 tuổi
      const birth = new Date(birthDate);
      const today = new Date();
      const age = today.getFullYear() - birth.getFullYear();
      const m = today.getMonth() - birth.getMonth();
      if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) {
        age--; // chưa đến sinh nhật
      }

      if (age < 18) {
        alert("⚠️ Bạn phải đủ 18 tuổi để đăng ký.");
        return;
      }

      // Chuyển gender từ chuỗi sang boolean/int như backend yêu cầu
      let gender = 1; // Nam = true (1)
      if (genderText === "Nữ") gender = 0;

      // Gửi dữ liệu đến API
      try {
        const res = await fetch("http://127.0.0.1:7777/register_customer", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            username,
            password,
            firstName,
            lastName,
            birthDate,
            gender,
            phone,
            email,
            address
          })
        });

        const data = await res.json();

        if (res.ok) {
          alert("✅ Đăng ký thành công!");
          window.location.href = "/index.html"; // chuyển sang đăng nhập
        } else {
          alert("❌ " + (data.msg || "Đăng ký thất bại"));
        }
      } catch (error) {
        console.error("Lỗi khi gửi yêu cầu:", error);
        alert("❌ Không thể kết nối đến máy chủ.");
      }
    });
  });
</script>

</html>